{"pageProps":{"projectName":"Rococo","currentAdr":{"slug":"20240611-use-audit-tables-for-auditing-purposes","package":null,"title":"Use _audit tables for auditing purposes","status":"accepted","supersededBy":null,"tags":[],"deciders":[],"body":{"enhancedMdx":"\n## Context and Problem Statement\n\nFor audit purposes, every change to an entity in the database creates a new version of the entity. We store all versions of the entity in the same table/collection. The `latest` attribute (boolean) is used to distinguish between the current version of an entity and it's previous version.\n\nA couple of issues with this approach is:  \n- It does not let us use record links in SurrealDB\n- We faced locking issues while trying to clean out large table in RansomSnare MySQL database.\n\n## Decision Outcome\n\nInstead of storing `latest`, we’ll have an `_audit` table for each data table.  Instead of marking records with the same `entity_id` as `latest=false`, we’ll `SELECT INTO` the `_audit` table from the data table and then upsert the new data.  \n\nWe expect this approach to give us all of the benefits of Big6 while allowing us to use the native features of SurrealDB effectively."},"creationDate":"2024-06-11T18:25:57.000Z","lastEditDate":"2024-06-11T18:25:57.000Z","lastEditAuthor":"anikiforov","publicationDate":"2023-11-18T23:59:59.000Z","file":{"relativePath":"docs/decisions/20240611-use-audit-tables-for-auditing-purposes.md","absolutePath":"/home/runner/work/rococo/rococo/docs/decisions/20240611-use-audit-tables-for-auditing-purposes.md"},"repository":{"provider":"github","viewUrl":"https://github.com/EcorRouge/rococo/blob/master/docs/decisions/20240611-use-audit-tables-for-auditing-purposes.md"}},"l4bVersion":"1.0.1"},"__N_SSG":true}